<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.6"/>
<title>AiCPlayer: src/main.c File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">AiCPlayer
   </div>
   <div id="projectbrief">Interface of aic vm - for rendering aspect, sensors, video records</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.6 -->
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Quick&#160;intro</span></a></li>
      <li><a href="pages.html"><span>AiC&#160;player&#160;usage</span></a></li>
      <li><a href="annotated.html"><span>Data&#160;Structures</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
      <li><a href="globals.html"><span>Globals</span></a></li>
    </ul>
  </div>
<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="dir_68267d1309a1af8e8297ef4c3efbcdba.html">src</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#define-members">Macros</a> &#124;
<a href="#func-members">Functions</a> &#124;
<a href="#var-members">Variables</a>  </div>
  <div class="headertitle">
<div class="title">main.c File Reference</div>  </div>
</div><!--header-->
<div class="contents">

<p>Main loop and graphical rendering.  
<a href="#details">More...</a></p>
<div class="textblock"><code>#include &lt;SDL2/SDL.h&gt;</code><br/>
<code>#include &lt;SDL2/SDL_error.h&gt;</code><br/>
<code>#include &lt;SDL2/SDL_events.h&gt;</code><br/>
<code>#include &lt;SDL2/SDL_keyboard.h&gt;</code><br/>
<code>#include &lt;SDL2/SDL_mouse.h&gt;</code><br/>
<code>#include &lt;SDL2/SDL_render.h&gt;</code><br/>
<code>#include &lt;SDL2/SDL_surface.h&gt;</code><br/>
<code>#include &lt;SDL2/SDL_syswm.h&gt;</code><br/>
<code>#include &lt;SDL2/SDL_version.h&gt;</code><br/>
<code>#include &lt;SDL2/SDL_video.h&gt;</code><br/>
<code>#include &lt;X11/Xlib.h&gt;</code><br/>
<code>#include &lt;pthread.h&gt;</code><br/>
<code>#include &lt;signal.h&gt;</code><br/>
<code>#include &lt;stdint.h&gt;</code><br/>
<code>#include &lt;stdio.h&gt;</code><br/>
<code>#include &lt;stdlib.h&gt;</code><br/>
<code>#include &lt;string.h&gt;</code><br/>
<code>#include &lt;unistd.h&gt;</code><br/>
<code>#include &quot;<a class="el" href="buffer__sizes_8h_source.html">buffer_sizes.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="config__env_8h_source.html">config_env.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="dump__trace_8h_source.html">dump_trace.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="grabber_8h_source.html">grabber.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="host__gl_8h_source.html">host_gl.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="logger_8h_source.html">logger.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="render__api_8h_source.html">render_api.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="sdl__events_8h_source.html">sdl_events.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="sensors_8h_source.html">sensors.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="socket_8h_source.html">socket.h</a>&quot;</code><br/>
</div><div class="textblock"><div class="dynheader">
Include dependency graph for main.c:</div>
<div class="dyncontent">
<div class="center"><img src="main_8c__incl.png" border="0" usemap="#src_2main_8c" alt=""/></div>
<map name="src_2main_8c" id="src_2main_8c">
<area shape="rect" id="node20" href="buffer__sizes_8h.html" title="Define common buffer sizes. " alt="" coords="1051,155,1155,181"/><area shape="rect" id="node21" href="config__env_8h.html" title="Utilities to get config values from the environment. " alt="" coords="2640,80,2736,107"/><area shape="rect" id="node22" href="dump__trace_8h.html" title="Define dump_trace() " alt="" coords="2760,80,2861,107"/><area shape="rect" id="node23" href="grabber_8h.html" title="grabber records videos or snapshots from ampq messages " alt="" coords="657,80,732,107"/><area shape="rect" id="node27" href="socket_8h.html" title="Define socket utilities to simplify networking. " alt="" coords="172,155,244,181"/><area shape="rect" id="node29" href="host__gl_8h.html" title="OpenGL proxy management. " alt="" coords="2885,80,2959,107"/><area shape="rect" id="node30" href="logger_8h.html" title="Logging macros. " alt="" coords="2985,80,3052,107"/><area shape="rect" id="node32" href="render__api_8h.html" title="Header for functions defined in the AOSP opengl libs. " alt="" coords="3077,80,3171,107"/><area shape="rect" id="node33" href="sdl__events_8h.html" title="Produce virtual input events from SDL events. " alt="" coords="435,80,531,107"/><area shape="rect" id="node34" href="sensors_8h.html" title="Defines ports and structures for sensor threads. " alt="" coords="859,80,937,107"/></map>
</div>
</div>
<p><a href="main_8c_source.html">Go to the source code of this file.</a></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="define-members"></a>
Macros</h2></td></tr>
<tr class="memitem:a7ce0df38eb467e59f209470c8f5ac4e6"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="main_8c.html#a7ce0df38eb467e59f209470c8f5ac4e6">LOG_TAG</a>&#160;&#160;&#160;&quot;main&quot;</td></tr>
<tr class="separator:a7ce0df38eb467e59f209470c8f5ac4e6"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a17676ea61e4ed741007f55af61f54be5"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="main_8c.html#a17676ea61e4ed741007f55af61f54be5">USER_EVENT_ROTATION</a>&#160;&#160;&#160;1</td></tr>
<tr class="separator:a17676ea61e4ed741007f55af61f54be5"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aa8d7cc77567beff0a1e499d54807255d"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="main_8c.html#aa8d7cc77567beff0a1e499d54807255d">USER_EVENT_NEWCLIENT</a>&#160;&#160;&#160;2</td></tr>
<tr class="separator:aa8d7cc77567beff0a1e499d54807255d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a20bbd303d613b11460252e119077a1ac"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="main_8c.html#a20bbd303d613b11460252e119077a1ac">INPUT_PORT</a>&#160;&#160;&#160;22469</td></tr>
<tr class="separator:a20bbd303d613b11460252e119077a1ac"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:ae66f6b31b5ad750f1fe042a706a4e3d4"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="main_8c.html#ae66f6b31b5ad750f1fe042a706a4e3d4">main</a> ()</td></tr>
<tr class="separator:ae66f6b31b5ad750f1fe042a706a4e3d4"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="var-members"></a>
Variables</h2></td></tr>
<tr class="memitem:a2d8e0f99a0335c685d9f3b12e8212811"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="main_8c.html#a2d8e0f99a0335c685d9f3b12e8212811">g_height</a></td></tr>
<tr class="memdesc:a2d8e0f99a0335c685d9f3b12e8212811"><td class="mdescLeft">&#160;</td><td class="mdescRight">Global variable for the window height.  <a href="#a2d8e0f99a0335c685d9f3b12e8212811">More...</a><br/></td></tr>
<tr class="separator:a2d8e0f99a0335c685d9f3b12e8212811"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a20cb2690069b1ba7821a2098b4b8590d"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="main_8c.html#a20cb2690069b1ba7821a2098b4b8590d">g_width</a></td></tr>
<tr class="memdesc:a20cb2690069b1ba7821a2098b4b8590d"><td class="mdescLeft">&#160;</td><td class="mdescRight">Global variable for the window width.  <a href="#a20cb2690069b1ba7821a2098b4b8590d">More...</a><br/></td></tr>
<tr class="separator:a20cb2690069b1ba7821a2098b4b8590d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a9ffc1311d2ed455ea05e12f89c0e8084"><td class="memItemLeft" align="right" valign="top">float&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="main_8c.html#a9ffc1311d2ed455ea05e12f89c0e8084">g_rotation</a> = 0.0</td></tr>
<tr class="separator:a9ffc1311d2ed455ea05e12f89c0e8084"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a73b874a26cb7b8b0eaeb40b79dd928a5"><td class="memItemLeft" align="right" valign="top">void *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="main_8c.html#a73b874a26cb7b8b0eaeb40b79dd928a5">g_window_id</a> = NULL</td></tr>
<tr class="memdesc:a73b874a26cb7b8b0eaeb40b79dd928a5"><td class="mdescLeft">&#160;</td><td class="mdescRight">Global variable for the X window id.  <a href="#a73b874a26cb7b8b0eaeb40b79dd928a5">More...</a><br/></td></tr>
<tr class="separator:a73b874a26cb7b8b0eaeb40b79dd928a5"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>Main loop and graphical rendering. </p>
<dl class="section author"><dt>Author</dt><dd>Alexandre BRUXELLE for ZENIKA</dd></dl>
<p>The main will start the opengl proxy thread, initialize the AOSP rendering libs on the port 22468, run the SDL input translator that connects to the VM on port 22469 that will send raw uinput events; and finally runs the sdl event loop.</p>
<p>Libs required to run the OpenGL remote rendering:</p>
<ul>
<li>lib64OpenglRender.so</li>
<li>lib64GLES_V2_translator.so</li>
<li>lib64GLES_CM_translator.so</li>
<li><p class="startli">lib64EGL_translator.so.</p>
<p class="startli">They can be obtained by building the sdk in the AOSP tree with our specific patch to add a callback function in case of screen rotation. </p>
</li>
</ul>

<p>Definition in file <a class="el" href="main_8c_source.html">main.c</a>.</p>
</div><h2 class="groupheader">Macro Definition Documentation</h2>
<a class="anchor" id="a20bbd303d613b11460252e119077a1ac"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define INPUT_PORT&#160;&#160;&#160;22469</td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Port used by the AiC VM for virtual input </p>

<p>Definition at line <a class="el" href="main_8c_source.html#l00076">76</a> of file <a class="el" href="main_8c_source.html">main.c</a>.</p>

</div>
</div>
<a class="anchor" id="a7ce0df38eb467e59f209470c8f5ac4e6"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define LOG_TAG&#160;&#160;&#160;&quot;main&quot;</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="main_8c_source.html#l00069">69</a> of file <a class="el" href="main_8c_source.html">main.c</a>.</p>

</div>
</div>
<a class="anchor" id="aa8d7cc77567beff0a1e499d54807255d"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define USER_EVENT_NEWCLIENT&#160;&#160;&#160;2</td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Custom SDL Event: new input daemon connection </p>

<p>Definition at line <a class="el" href="main_8c_source.html#l00073">73</a> of file <a class="el" href="main_8c_source.html">main.c</a>.</p>

</div>
</div>
<a class="anchor" id="a17676ea61e4ed741007f55af61f54be5"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define USER_EVENT_ROTATION&#160;&#160;&#160;1</td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Custom SDL Event: Rotation event from the VM </p>

<p>Definition at line <a class="el" href="main_8c_source.html#l00071">71</a> of file <a class="el" href="main_8c_source.html">main.c</a>.</p>

</div>
</div>
<h2 class="groupheader">Function Documentation</h2>
<a class="anchor" id="ae66f6b31b5ad750f1fe042a706a4e3d4"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int main </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="main_8c_source.html#l00306">306</a> of file <a class="el" href="main_8c_source.html">main.c</a>.</p>

<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="main_8c_ae66f6b31b5ad750f1fe042a706a4e3d4_cgraph.png" border="0" usemap="#main_8c_ae66f6b31b5ad750f1fe042a706a4e3d4_cgraph" alt=""/></div>
<map name="main_8c_ae66f6b31b5ad750f1fe042a706a4e3d4_cgraph" id="main_8c_ae66f6b31b5ad750f1fe042a706a4e3d4_cgraph">
<area shape="rect" id="node2" href="logger_8h.html#ab3d0e9567cfad5d6f83abc585beb520d" title="init_logger" alt="" coords="150,5,231,32"/><area shape="rect" id="node3" href="dump__trace_8h.html#a1dbeb43c562db25d4cabbc112fc8f409" title="Dump a backtrace if there is a segfault. " alt="" coords="145,56,236,83"/><area shape="rect" id="node4" href="config__env_8h.html#a7a3442c830784b7d0aea5290269232ad" title="Get the value of a config variable from the env. " alt="" coords="533,329,648,356"/><area shape="rect" id="node5" href="config__env_8h.html#a69c8b3fe2efa7bf253919822e0955b13" title="Get the value of a integer config variable from the env. " alt="" coords="143,157,239,184"/><area shape="rect" id="node6" href="config__env_8h.html#a64a6493a7d79d58276bbd3e7a0041083" title="Get the value of a boolean config variable from the env. " alt="" coords="137,208,244,235"/><area shape="rect" id="node7" href="grabber_8h.html#aedfbbbd02a0acd665e2d4acb36ff73b1" title="Set the static path to the screenshots/movies dir. " alt="" coords="107,259,275,285"/><area shape="rect" id="node8" href="render__api_8h.html#ab817145310afe4cfc3502a5823c97aeb" title="initLibrary" alt="" coords="151,309,230,336"/><area shape="rect" id="node9" href="render__api_8h.html#a0a8064c551728bb88523a7bfc10472ce" title="setStreamMode" alt="" coords="133,360,248,387"/><area shape="rect" id="node10" href="render__api_8h.html#a051b34bb0e79229a04c1270a5ae8de33" title="initOpenGLRenderer" alt="" coords="121,411,261,437"/><area shape="rect" id="node11" href="host__gl_8h.html#a996ddc93a44b79d5170cbb809ad75703" title="Manage the remote OpenGL to the VM. " alt="" coords="125,461,256,488"/><area shape="rect" id="node14" href="render__api_8h.html#a68714790601e21a0462f6fc18d38c952" title="createOpenGLSubwindow" alt="" coords="104,512,277,539"/><area shape="rect" id="node15" href="render__api_8h.html#a7963cb6edbe8f673efceb71159eff7fb" title="AiC_CallbackRotation" alt="" coords="115,563,266,589"/><area shape="rect" id="node16" href="render__api_8h.html#ac750289cb029558e2d02d0cfd2acc7f9" title="AiC_setDPI" alt="" coords="145,613,237,640"/><area shape="rect" id="node17" href="grabber_8h.html#a59a47331bd2c7708cc7aa10a2f1f5bbc" title="grab_handler_amqp" alt="" coords="123,664,258,691"/><area shape="rect" id="node22" href="grabber_8h.html#a9d9ad64cb39218bf4bd0f000fde19558" title="Start/Stop from socket connection via protobuf message. " alt="" coords="125,715,256,741"/><area shape="rect" id="node12" href="socket_8h.html#af8242b562c5990b1eb0cfc91e309e882" title="Open a socket with SO_REUSEADDR. " alt="" coords="325,436,485,463"/><area shape="rect" id="node13" href="socket_8h.html#aed3900fc0c59086419e490f0266b04e5" title="Open a socket with TCP_NODELAY. " alt="" coords="331,487,479,513"/><area shape="rect" id="node18" href="amqp__listen_8h.html#a1ccb8b60f25915a15fceccc2e0918b9d" title="Setup a consumer for a specific queue. " alt="" coords="343,551,468,577"/><area shape="rect" id="node19" href="amqp__listen_8h.html#ac058263f3c34db38b9bc0f492e95f6aa" title="Consume one message from a connection object. " alt="" coords="348,613,463,640"/><area shape="rect" id="node20" href="grabber_8c.html#a0497bd4df0c871e0997655fd69f32cd6" title="Function passed to a thread in order to detect format encoding &#45; encode frame&#45; and write in a file..." alt="" coords="349,664,461,691"/><area shape="rect" id="node21" href="grabber_8c.html#a48f6cd7606f077585e21d8aec736a1ee" title="grab_snapshot" alt="" coords="352,715,459,741"/></map>
</div>
</p>

</div>
</div>
<h2 class="groupheader">Variable Documentation</h2>
<a class="anchor" id="a2d8e0f99a0335c685d9f3b12e8212811"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int g_height</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Global variable for the window height. </p>
<p>Height of the window (can be resized at runtime)</p>
<p>Shared with the grabber. </p>

<p>Definition at line <a class="el" href="main_8c_source.html#l00087">87</a> of file <a class="el" href="main_8c_source.html">main.c</a>.</p>

</div>
</div>
<a class="anchor" id="a9ffc1311d2ed455ea05e12f89c0e8084"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">float g_rotation = 0.0</td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Rotation angle of the VM</p>
<p>Shared width sdl events </p>

<p>Definition at line <a class="el" href="main_8c_source.html#l00100">100</a> of file <a class="el" href="main_8c_source.html">main.c</a>.</p>

</div>
</div>
<a class="anchor" id="a20cb2690069b1ba7821a2098b4b8590d"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int g_width</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Global variable for the window width. </p>
<p>Width of the window (can be resized at runtime)</p>
<p>Shared with the grabber. </p>

<p>Definition at line <a class="el" href="main_8c_source.html#l00093">93</a> of file <a class="el" href="main_8c_source.html">main.c</a>.</p>

</div>
</div>
<a class="anchor" id="a73b874a26cb7b8b0eaeb40b79dd928a5"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void* g_window_id = NULL</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Global variable for the X window id. </p>
<p>X Window ID </p>

<p>Definition at line <a class="el" href="main_8c_source.html#l00103">103</a> of file <a class="el" href="main_8c_source.html">main.c</a>.</p>

</div>
</div>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Tue Jan 24 2017 16:16:31 for AiCPlayer by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.6
</small></address>
</body>
</html>
